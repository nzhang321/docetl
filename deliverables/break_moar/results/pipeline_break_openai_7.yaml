datasets:
  transcripts:
    path: C:\Users\nickz\cuhk_app\docetl\data_sample.json
    type: file
default_model: openai/gpt-5-nano
bypass_cache: true
operations:
- name: extract_place_names
  type: map
  output:
    schema:
      place_names: list[str]
  prompt: 'Extract all instances in: {{ input.content }} where the speaker mentions
    a place name.

    '
  gleaning:
    validation_prompt: "You are an automatic validator. Compare the candidate extraction\
      \ (the list under the key \"place_names\") against the transcript text and evaluate\
      \ the extraction for completeness and accuracy. Apply these checks:\n\n1) Completeness:\
      \ Every distinct place name (city, state, country, region, landmark, or well-known\
      \ geographic/political entity) explicitly spoken by any speaker in the transcript\
      \ should be present. Do not add places that are only implied or not actually\
      \ mentioned.\n\n2) Correctness: Each item must be an actual place name and must\
      \ match what was spoken. Remove any items that are not place names (people,\
      \ organizations, policies, abstract concepts, or mis-parsed tokens).\n\n3) Granularity\
      \ & canonicalization: Prefer canonical, human-readable forms (e.g., \"United\
      \ States\" instead of \"U.S.\", \"Scranton, Pennsylvania\" if the transcript\
      \ mentions both together). Normalize obvious abbreviations when safe, but do\
      \ not invent or infer places that were not said.\n\n4) Uniqueness: Remove duplicates\
      \ and near-duplicates; return one canonical entry per distinct place.\n\n5)\
      \ Formatting: Return place names as plain strings, properly capitalized and\
      \ free of extraneous punctuation.\n\nIf the candidate list meets all criteria,\
      \ respond exactly with:\n\nPASS\n\nIf it does not meet all criteria, respond\
      \ only with a JSON object (no extra text) with these fields to guide refinement:\n\
      {\n  \"validation_pass\": false,\n  \"feedback\": \"A concise description of\
      \ what is wrong or missing (1-2 sentences)\",\n  \"remove\": [ list of items\
      \ from the candidate that are incorrect or irrelevant ],\n  \"add\": [ list\
      \ of place names that should be added based on the transcript ],\n  \"replace\"\
      : [ [\"incorrect_item\",\"correct_item\"], ... ],\n  \"suggested_place_names\"\
      : [ the corrected, canonical list of place names to use ]\n}\n\nMake feedback\
      \ and the lists as specific and actionable as possible so the generator can\
      \ apply the exact corrections."
    num_rounds: 3
    model: openai/gpt-5-mini
pipeline:
  steps:
  - name: extract_place_names
    input: transcripts
    operations:
    - extract_place_names
  output:
    type: file
    path: C:\Users\nickz\cuhk_app\docetl\results\moar_optimization\results\pipeline_break_openai_7.json
optimizer_config:
  type: moar
  save_dir: results/moar_optimization/results
  available_models:
  - openai/gpt-5-mini
  - openai/gpt-5-nano
  evaluation_file: evaluate_place_names.py
  metric_key: place_name_extraction_score
  max_iterations: 10
  rewrite_agent_model: openai/gpt-5-mini
  model: openai/gpt-5-mini
rate_limits:
  llm_call:
  - count: 500
    per: 1
    unit: minute
  llm_tokens:
  - count: 500000
    per: 1
    unit: minute
